<% layout("/layouts/boilerplate")%>

<div class="container mt-4">
    <h2 class="mb-4">Admin Dashboard</h2>
    
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Users</h5>
                    <p class="card-text display-4"><%= stats.totalUsers %></p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Listings</h5>
                    <p class="card-text display-4"><%= stats.totalListings %></p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Bookings</h5>
                    <p class="card-text display-4"><%= stats.totalBookings %></p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Reviews</h5>
                    <p class="card-text display-4"><%= stats.totalReviews %></p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Users by Role</h5>
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(let role of stats.usersByRole) { %>
                                <tr>
                                    <td><%= role._id ? role._id.replace('_', ' ').toUpperCase() : 'UNKNOWN' %></td>
                                    <td><%= role.count %></td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Booking Statistics</h5>
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Count</th>
                                <th>Revenue</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(let stat of stats.bookingStats) { %>
                                <tr>
                                    <td><%= stat._id ? stat._id.toUpperCase() : 'UNKNOWN' %></td>
                                    <td><%= stat.count %></td>
                                    <td>&#8377;<%= stat.revenue.toLocaleString('en-IN') %></td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Users</h5>
            <a href="/admin/users" class="btn btn-sm btn-primary">Manage All Users</a>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let user of recentUsers) { %>
                        <tr>
                            <td><%= user.username %></td>
                            <td><%= user.email %></td>
                            <td><span class="badge bg-info"><%= user.role.replace('_', ' ').toUpperCase() %></span></td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Listings</h5>
            <a href="/listings" class="btn btn-sm btn-primary">View All Listings</a>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Location</th>
                        <th>Price</th>
                        <th>Owner</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let listing of recentListings) { %>
                        <tr>
                            <td><a href="/listings/<%= listing._id %>"><%= listing.title %></a></td>
                            <td><%= listing.location %></td>
                            <td>&#8377;<%= listing.price.toLocaleString('en-IN') %></td>
                            <td><%= listing.owner ? listing.owner.username : 'N/A' %></td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Bookings</h5>
            <a href="/bookings/all" class="btn btn-sm btn-primary">View All Bookings</a>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Listing</th>
                        <th>Customer</th>
                        <th>Check-in</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let booking of recentBookings) { %>
                        <tr>
                            <td><%= booking.listing ? booking.listing.title : 'N/A' %></td>
                            <td><%= booking.customer ? booking.customer.username : 'N/A' %></td>
                            <td><%= new Date(booking.checkIn).toLocaleDateString() %></td>
                            <td><span class="badge bg-<%= booking.status === 'confirmed' ? 'success' : 'warning' %>"><%= booking.status.toUpperCase() %></span></td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>
